# D1T5:Josephus问题(3)

## 1.内容和目的

n个人排成一圈，按顺时针方向依次编号1，2，3…n。从编号为1的人开始顺时针"一二三...."报数，报到m的人退出圈子。这样不断循环下去，圈子里的人将不断减少。最终一定会剩下一个人。试问最后剩下的人的编号。

本题的数据规模更具有挑战性，尝试更通用且高效的算法。

## 2.分析与设计实现

### 分析

考虑针对d1t4-Method2进行优化，考虑到`n`远大于`m`。可能要很多次才能到达环末。此时的环可以这样看：

$$(A_{m-1}+B_1)_{\lfloor{\frac{n}{m}}\rfloor}+C_{n\%m} \tag{0}$$

Tips:`A`表示跳过的人，`B`表示淘汰的人，`+`号表示链接，下标表示重复多少次

考虑一次递推淘汰掉所有`B`，即调用，$g(x)$为一式子

$$f(n,m)=g(f(n-\frac{n}{m},m))\tag{1}$$

去掉$B$之后的环视图应该是下图，注意我们得到了下一层函数返回的剩下的人的位置其实是从`C`处开始的，还需要正确处理坐标的偏移量。

$$(A_{m-1})_{\lfloor{\frac{n}{m}}\rfloor}+\underbrace{C_{n\%m}}_{\text{start here}} \tag{2}$$

考虑处理坐标的偏移量，即求$(2)$式到$(0)$的$g(x)$

$$
g(x)=\left\{
\begin{aligned}
x+\lfloor\frac{n}{m}\rfloor & & ,x<n\%m &,(3)\\
x-n\%m+(x-n\%m-1)/(m-1) & & ,x\ge n\%m & ,(4)\\
\end{aligned} \right.
$$

$(3)$：当$x$落在$(2)$中的`C`上时，补上$\lfloor\frac{n}{m}\rfloor$个`B`的坐标转换式即可完成映射

$(4)$：当$x$落在$(2)$中的`A`上时，先在不考虑`B`，然后在补上`B`的影响


考虑边界情况，$f(1,m)=1$

发现$m=1$时$(3)$未定义，此时$f(n,1)=n$

又发现$n\le m$时此式无法进行，可使用d1t4-Method2方法$f(n,m)=f(n,1)$

### 核心代码

```cpp
int f(int n,int m){
    if (m==1) return n;
    if (n==1) return 1;
    if (n<=m) return (f(n-1,m)+m-1)%n+1;
    int w=n%m,e=n-n/m,l=n/m*m;
    int a=f(e,m);
    if (a<=w) return a+l;
    a-=w;a+=(a-1)/(m-1);
    return a;
}
```

## 3.性能分析

当$n=m$时，显然为$O(m)$

当$n>m$时，每一轮$n$变为$n-\lfloor{\frac{n}{m}}\rfloor$。最坏情况设$m=2$，$n$变为$\lceil{\frac{n}{2}}\rceil$，不断的除2，显然为$O(\log(n))$

叠加在一起为$O(m+\log(n))$

## 4.小结

探索了美妙的数学，将数学知识和计算机编程语言巧妙地结合在一起

